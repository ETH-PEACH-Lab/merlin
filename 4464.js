"use strict";(self.webpackChunkonsenui_v2_react_minimum=self.webpackChunkonsenui_v2_react_minimum||[]).push([[4464],{8035:(t,e,a)=>{function r(t,e){"accDescr"in t&&t.accDescr&&e.setAccDescription?.(t.accDescr),"accTitle"in t&&t.accTitle&&e.setAccTitle?.(t.accTitle),"title"in t&&t.title&&e.setDiagramTitle?.(t.title)}a.d(e,{S:()=>r}),(0,a(6852).K2)(r,"populateCommonDb")},4464:(t,e,a)=>{a.d(e,{diagram:()=>Q});var r,n=a(8035),o=a(3201),i=a(693),l=a(9342),s=a(8812),d=a(6852),c=[],p=[...c],h=s.UI.visual,m=(0,d.K2)((()=>(0,l.$t)({...h,...(0,s.zj)().visual})),"getConfig"),f=(0,d.K2)((()=>p),"getPages"),x=(0,d.K2)((t=>{p.push(t)}),"addPage"),g=(0,d.K2)((()=>r),"getSize"),b=(0,d.K2)((t=>{r=t}),"setSize"),w={getPages:f,addPage:x,getConfig:m,clear:(0,d.K2)((()=>{(0,s.IU)(),p=[...c],r=void 0}),"clear"),setAccTitle:s.SV,getAccTitle:s.iN,setDiagramTitle:s.ke,getDiagramTitle:s.ab,getAccDescription:s.m7,setAccDescription:s.EI,getSize:g,setSize:b},u=(0,d.K2)((t=>{(0,n.S)(t,w),t.size&&w.setSize&&w.setSize({width:t.size.width,height:t.size.height});const e=(0,d.K2)(((t,e)=>{if(t){if("column"in t&&"row"in t){const e=t.column,a=t.row,r=e&&"start"in e&&"end"in e,n=a&&"start"in a&&"end"in a;return r||n?{column:r?{start:e.start,end:e.end}:e.single??e,row:n?{start:a.start,end:a.end}:a.single??a}:{column:e.single??e,row:a.single??a}}return{type:"previous",placement:e||"below"}}}),"processPosition");for(const a of t.pages){const t=a.subDiagrams.map((t=>{switch(t.diagramType){case"array":return{type:"array",orientation:t.orientation,title:t.diagramTitle,position:e(t.position),showIndex:t.showIndex,label:t.label,elements:t.elements.map((t=>({value:t.value,color:t.color,arrow:void 0!==t.arrowLabel&&null!==t.arrowLabel,arrowLabel:t.arrowLabel})))};case"matrix":return{type:"matrix",title:t.diagramTitle,position:e(t.position),rows:t.rows.map((t=>({elements:t.elements.map((t=>({value:t.value,color:t.color,arrow:void 0!==t.arrowLabel&&null!==t.arrowLabel,arrowLabel:t.arrowLabel})))}))),showIndex:t.showIndex,label:t.label};case"stack":return{type:"stack",orientation:t.orientation,title:t.diagramTitle,position:e(t.position),showIndex:t.showIndex,label:t.label,size:t.size,elements:t.elements.map((t=>({value:t.value,color:t.color,arrow:void 0!==t.arrowLabel&&null!==t.arrowLabel,arrowLabel:t.arrowLabel})))};case"tree":return{type:"tree",title:t.diagramTitle,position:e(t.position),label:t.label,elements:t.elements.map((t=>{if("TreeNodeDefinition"===t.$type)return{nodeDefinition:{nodeId:t.nodeId,value:t.value,color:t.color,arrow:void 0!==t.arrowLabel&&null!==t.arrowLabel,arrowLabel:t.arrowLabel,hidden:"true"===(t.hidden||"").toLowerCase()}};if("TreeChildDefinition"===t.$type)return{childDefinition:{parent:t.parent,child:t.child}};throw new Error(`Unknown tree element type: ${t.$type}`)}))};case"graph":return{type:"graph",title:t.diagramTitle,position:e(t.position),label:t.label,elements:t.elements.map((t=>{if("NodeDefinition"==t.$type)return{type:"node",nodeId:t.nodeId,value:t.value,color:t.color,arrow:void 0!==t.arrowLabel&&null!==t.arrowLabel,arrowLabel:t.arrowLabel,hidden:"true"==(t.hidden||"").toLowerCase()};if("EdgeDefinition"==t.$type)return{type:"edge",start:t.start,end:t.end,value:t.value,color:t.color};throw new Error("Unknown graph element type")}))};case"linkedList":return{type:"linkedList",title:t.diagramTitle,position:e(t.position),label:t.label,elements:t.elements.map((t=>({value:t.value,color:t.color,arrow:!!t.arrowLabel,arrowLabel:t.arrowLabel})))};case"text":return{type:"text",title:t.diagramTitle,position:e(t.position,t.placement),fontSize:t.fontSize,color:t.color,fontWeight:t.fontWeight,fontFamily:t.fontFamily,align:t.align,lineSpacing:t.lineSpacing,width:t.width,height:t.height,label:t.label,elements:t.elements.map((t=>{if(t.attributes&&t.attributes.length>0){const e={value:t.value};return t.attributes.forEach((t=>{void 0!==t.fontSize&&(e.fontSize=t.fontSize),void 0!==t.color&&(e.color=t.color),void 0!==t.fontWeight&&(e.fontWeight=t.fontWeight),void 0!==t.fontFamily&&(e.fontFamily=t.fontFamily),void 0!==t.align&&(e.align=t.align)})),e}return t.value}))};default:throw new Error(`Unknown diagram type: ${t.diagramType}`)}}));w.addPage({layout:a.layout?{columns:a.layout.columns,rows:a.layout.rows}:void 0,subDiagrams:t})}}),"populate"),y={parse:async t=>{const e=await(0,o.q)("visual",t);s.Rm.debug(e),u(e)}},k=(0,d.K2)(((t,e=.6)=>{if(L(t))return t||"null";const a={black:"#000000",white:"#FFFFFF",red:"#FF0000",green:"#008000",blue:"#0000FF",yellow:"#FFFF00",cyan:"#00FFFF",magenta:"#FF00FF",gray:"#808080",grey:"#808080",maroon:"#800000",olive:"#808000",purple:"#800080",teal:"#008080",navy:"#000080",orange:"#FFA500",pink:"#FFC0CB",brown:"#A52A2A",aqua:"#00FFFF",lime:"#00FF00",gold:"#FFD700",silver:"#C0C0C0",beige:"#F5F5DC",coral:"#FF7F50",chocolate:"#D2691E",crimson:"#DC143C",indigo:"#4B0082",khaki:"#F0E68C",lavender:"#E6E6FA",orchid:"#DA70D6",plum:"#DDA0DD",salmon:"#FA8072",sienna:"#A0522D",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",azure:"#F0FFFF",ivory:"#FFFFF0",mintcream:"#F5FFFA",snow:"#FFFAFA",goldenrod:"#DAA520",tomato:"#FF6347",slateblue:"#6A5ACD",darkgreen:"#006400",darkblue:"#00008B",darkred:"#8B0000",darkorange:"#FF8C00",darkviolet:"#9400D3",darkkhaki:"#BDB76B",lightblue:"#ADD8E6",lightgreen:"#90EE90",lightcoral:"#F08080",lightgray:"#D3D3D3",lightgrey:"#D3D3D3"},r=t?t.toLowerCase():"";return r in a?v(a[r],e):"white"}),"getColor");function L(t){return!!t&&/^#([\dA-Fa-f]{3}){1,2}$/.test(t)}(0,d.K2)(L,"isValidHexColor");var v=(0,d.K2)(((t,e)=>(t=t.replace(/^#/,""),`rgba(${parseInt(t.slice(0,2),16)}, ${parseInt(t.slice(2,4),16)}, ${parseInt(t.slice(4,6),16)}, ${e})`)),"hexToRgba"),F=(0,d.K2)((t=>{let e=t.toString();return e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1)),"null"===e?"":"\\null"===e?"null":e}),"formatValue"),E=(0,d.K2)((t=>{if(!t)return!1;let e=t.toString();return e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1)),"null"!==e}),"shouldDisplayArrowLabel"),D=(0,d.K2)(((t,e,a,r)=>{t.append("defs").append("marker").attr("id","arrowhead").attr("viewBox","0 0 10 10").attr("refX","5").attr("refY","5").attr("markerWidth","6").attr("markerHeight","6").attr("orient","auto-start-reverse").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("fill","black"),e.title&&t.append("text").attr("x",100).attr("y",20).attr("fill",a.labelColor).attr("font-size","16").attr("dominant-baseline","hanging").attr("text-anchor","middle").attr("class","arrayDiagramTitle").text(e.title);const n=t.append("g").attr("class","component").attr("id",`component_${r}`).attr("transform","translate(50, 40)");let o=0;if(e.elements.forEach(((t,r)=>{z(n,t,r,a,e.showIndex||!1,o),o+=1})),e.label){const t=160,r=100;n.append("text").attr("x",r).attr("y",t).attr("fill",a.labelColor).attr("font-size","16").attr("dominant-baseline","hanging").attr("text-anchor","middle").attr("class","arrayDiagramLabel").text(e.label)}}),"drawArrayDiagram"),z=(0,d.K2)(((t,e,a,{labelColor:r,labelFontSize:n},o,i)=>{const l=t.append("g");l.attr("class","unit").attr("id",`unit_${i}`);const s=40*a,d=k(e.color);if(e.arrow&&E(e.arrowLabel)){const t=10,a=40;l.append("line").attr("x1",s+20).attr("y1",t).attr("x2",s+20).attr("y2",a).attr("stroke","black").attr("stroke-width","1.5").attr("marker-end","url(#arrowhead)"),E(e.arrowLabel)&&l.append("text").attr("x",s+20).attr("y",t-20).attr("fill",r).attr("font-size","16").attr("dominant-baseline","hanging").attr("text-anchor","middle").attr("class","arrowContext").text(F(e.arrowLabel||""))}l.append("rect").attr("x",s).attr("y",50).attr("width",40).attr("height",40).style("fill",d).attr("stroke","#000000").attr("stroke-width","2px").attr("class","arrayElement"),l.append("text").attr("x",s+20).attr("y",70).attr("fill",r).attr("font-size","16").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","elementLabel").text(F(e.value)),o&&l.append("text").attr("x",s+20).attr("y",110).attr("fill",r).attr("font-size","16").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","indexLabel").text(a)}),"drawElement"),S=(0,d.K2)(((t,e,a,r)=>{e.title;const n=t.append("g");n.attr("class","component").attr("id",`component_${r}`);const o=e.rows.length,i=Math.max(...e.rows.map((t=>t.elements.length)));if(e.title&&t.append("text").attr("x",50).attr("y",0).attr("fill",a.labelColor).attr("font-size",a.labelFontSize).attr("dominant-baseline","hanging").attr("text-anchor","start").attr("class","diagramTitle").text(e.title),e.rows.forEach(((t,e)=>{t.elements.forEach(((t,r)=>{$(n,t,e,r,a),I(n,e,r,a)}))})),e.label){const t=50*o+50,r=25*i;n.append("text").attr("x",r).attr("y",t).attr("fill",a.labelColor).attr("font-size",a.labelFontSize).attr("dominant-baseline","hanging").attr("text-anchor","middle").attr("class","arrayDiagramLabel").text(e.label)}e.showIndex&&K(n,o,i,a)}),"drawMatrixDiagram"),$=(0,d.K2)(((t,e,a,r,{labelColor:n,labelFontSize:o})=>{const i=t.append("g");i.attr("class","unit").attr("id",`unit_(${a},${r})`);const l=50*r,s=50*a,d=k(e.color);i.append("rect").attr("x",l).attr("y",s).attr("width",50).attr("height",50).style("fill",d).attr("stroke","#000000").attr("stroke-width","1.2px").attr("class","matrixElement");const c=F(e.value);i.append("text").attr("x",l+25).attr("y",s+25).attr("fill",n).attr("font-size",o).attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","elementLabel").text(c),e.arrow&&E(e.arrowLabel)&&(i.append("circle").attr("cx",l+25).attr("cy",s+25).attr("r",23).attr("stroke","red").attr("stroke-width","2").attr("fill","none"),i.append("text").attr("x",l+52).attr("y",s+25).attr("fill","red").attr("font-size",o).attr("dominant-baseline","middle").attr("text-anchor","start").attr("class","arrowLabel").text(F(e.arrowLabel||"")))}),"drawElement"),K=(0,d.K2)(((t,e,a,{labelColor:r,labelFontSize:n})=>{const o=t.append("g");for(let t=0;t<e;t++)o.append("text").attr("x",-10).attr("y",50*t+25).attr("fill",r).attr("font-size",n).attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","rowIndex").text(t.toString());for(let t=0;t<a;t++)o.append("text").attr("x",50*t+25).attr("y",-10).attr("fill",r).attr("font-size",n).attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","colIndex").text(t.toString())}),"addIndices"),I=(0,d.K2)(((t,e,a,{borderColor:r,borderWidth:n})=>{const o=50*a,i=50*e;t.append("g").append("rect").attr("x",o).attr("y",i).attr("width",50).attr("height",50).attr("stroke",r).attr("stroke-width",n).attr("fill","none")}),"drawGrid"),C=(0,d.K2)(((t,e,a)=>{t.append("defs").append("marker").attr("id","arrowhead").attr("viewBox","0 0 10 10").attr("refX","5").attr("refY","5").attr("markerWidth","6").attr("markerHeight","6").attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("fill","black");const r=t.append("g");r.attr("class","component").attr("id",`component_${a}`);const n=40*e.size;A(r,50,0,70,n);let o=0;if(e.elements.forEach(((t,a)=>{const n=e.size-e.elements.length+a;M(r,t,n,o),o+=1})),e.label){const t=n+40+20,a=85;r.append("text").attr("x",a).attr("y",t).attr("fill","black").attr("font-size","16").attr("dominant-baseline","hanging").attr("text-anchor","middle").attr("class","stackDiagramLabel").text(e.label)}}),"drawStackDiagram"),M=(0,d.K2)(((t,e,a,r)=>{const n=t.append("g");n.attr("class","unit").attr("id",`unit_${r}`);const o=40*a,i=k(e.color);if(n.append("rect").attr("x",50).attr("y",o).attr("width",70).attr("height",40).style("fill",i).attr("stroke","black").attr("stroke-width","1").attr("class","stackElement"),e.arrow&&E(e.arrowLabel)){const t=130,a=t+40;n.append("line").attr("x1",a).attr("y1",o+20).attr("x2",t).attr("y2",o+20).attr("stroke","black").attr("stroke-width","1.5").attr("marker-end","url(#arrowhead)"),E(e.arrowLabel)&&n.append("text").attr("x",a+10).attr("y",o+20).attr("fill","black").attr("font-size","16").attr("dominant-baseline","middle").attr("text-anchor","start").attr("class","arrowContext").text(F(e.arrowLabel||""))}n.append("text").attr("x",85).attr("y",o+20).attr("fill","black").attr("font-size","16").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","elementLabel").text(F(e.value))}),"drawElement"),A=(0,d.K2)(((t,e,a,r,n)=>{const o="#000000";t.append("line").attr("x1",e).attr("y1",a).attr("x2",e).attr("y2",a+n).attr("stroke",o).attr("stroke-width",2),t.append("line").attr("x1",e+r).attr("y1",a).attr("x2",e+r).attr("y2",a+n).attr("stroke",o).attr("stroke-width",2),t.append("line").attr("x1",e).attr("y1",a+n).attr("x2",e+r).attr("y2",a+n).attr("stroke",o).attr("stroke-width",2)}),"drawFramework"),T=(0,d.K2)(((t,e,a)=>{const r=t.append("g");r.attr("class","component").attr("id",`component_${a}`),r.append("defs").append("marker").attr("id","arrowhead").attr("viewBox","0 0 10 10").attr("refX","5").attr("refY","5").attr("markerWidth","4").attr("markerHeight","5").attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("fill","black");const n=e.elements.filter((t=>"node"==t.type)),o=new Set(n.filter((t=>t.hidden)).map((t=>t.nodeId))),i=n.filter((t=>!t.hidden)),l=e.elements.filter((t=>"edge"==t.type&&!o.has(t.start)&&!o.has(t.end))),s=W(n||[]);if(l&&l.forEach((t=>{_(r,t,s)})),i){let t=0;i.forEach((e=>{B(r,e,s[e.nodeId],t),t+=1}))}if(e.label){const t=i?100*Math.ceil(i.length/3)+70:100,a=150;r.append("text").attr("x",a).attr("y",t).attr("fill","black").attr("font-size","16").attr("dominant-baseline","hanging").attr("text-anchor","middle").attr("class","graphDiagramLabel").text(e.label)}}),"drawGraphDiagram"),W=(0,d.K2)((t=>{const e={},a=2*Math.PI/t.length;return t.forEach(((t,r)=>{const n=r*a;e[t.nodeId]={x:150+100*Math.cos(n),y:150+100*Math.sin(n)}})),e}),"calculateNodePositions"),B=(0,d.K2)(((t,e,a,r)=>{if(e.hidden)return;const n=a.x,o=a.y,i=k(e.color),l=t.append("g");if(l.attr("class","unit").attr("id",`unit_${r}`),l.append("circle").attr("cx",n).attr("cy",o).attr("r",20).style("fill",i).attr("stroke","black").attr("stroke-width","1").attr("class","graphNode"),l.append("text").attr("x",n).attr("y",o).attr("dy",".35em").attr("fill","black").attr("font-size","16").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","nodeLabel").text(F(e.value||e.nodeId)),e.arrow&&E(e.arrowLabel)){const t=n+45,a=n+25;l.append("line").attr("x1",t).attr("y1",o).attr("x2",a).attr("y2",o).attr("stroke","black").attr("stroke-width","2").attr("marker-end","url(#arrowhead)"),l.append("text").attr("x",t+5).attr("y",o).attr("fill","black").attr("font-size","14").attr("dominant-baseline","middle").attr("text-anchor","start").attr("class","arrowLabel").text(F(e.arrowLabel||""))}}),"drawNode"),_=(0,d.K2)(((t,e,a)=>{const r=a[e.start],n=a[e.end];if(r&&n){const{startX:a,startY:o,endX:i,endY:l}=P(r,n),s=e.color||"black";t.append("line").attr("x1",a||0).attr("y1",o||0).attr("x2",i||0).attr("y2",l||0).attr("stroke",s).attr("stroke-width","2"),e.value&&t.append("text").attr("x",(a+i)/2).attr("y",(o+l)/2).attr("fill","black").attr("font-size","16").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","edgeLabel").text(F(e.value))}}),"drawEdge"),P=(0,d.K2)(((t,e)=>{const a=e.x-t.x,r=e.y-t.y,n=Math.sqrt(a*a+r*r),o=20*a/n,i=20*r/n;return{startX:t.x+o,startY:t.y+i,endX:e.x-o,endY:e.y-i}}),"calculateEdgePosition"),X=(0,d.K2)(((t,e,a)=>{const r=t.append("g");r.attr("class","component").attr("id",`component_${a}`),r.append("defs").append("marker").attr("id","arrowhead").attr("viewBox","0 0 10 10").attr("refX","5").attr("refY","5").attr("markerWidth","4").attr("markerHeight","5").attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("fill","black");const n=e.elements||[],o=[],i=[];n.forEach((t=>{t.nodeDefinition&&o.push(t.nodeDefinition),t.childDefinition&&i.push(t.childDefinition)}));const l=new Map;i.forEach((t=>{const e=l.get(t.parent)||0;l.set(t.parent,e+1)}));const s=Math.max(...l.values(),0);if(s>10)return void r.append("text").attr("x",100).attr("y",50).attr("fill","#faa").attr("font-size","16").attr("text-anchor","start").text(`Warning: Node has ${s} children (max recommended: 10)`);const d=Y(o,i);if(0===d.length)return;const c=N(d,i,o);i.forEach((t=>{H(r,t,c)}));let p=0;if(o.forEach((t=>{const e=c[t.nodeId];e&&(j(r,t,e,p),p+=1)})),e.label){const t=Math.max(...Object.values(c).map((t=>t.y)))+70,a=150;r.append("text").attr("x",a).attr("y",t).attr("fill","black").attr("font-size","16").attr("dominant-baseline","hanging").attr("text-anchor","middle").attr("class","treeDiagramLabel").text(e.label)}}),"drawTreeDiagram"),Y=(0,d.K2)(((t,e)=>{const a=new Set(e.map((t=>t.child)));return t.filter((t=>!a.has(t.nodeId)))}),"buildTreeStructure"),N=(0,d.K2)(((t,e,a)=>{const r={};if(0===t.length)return r;const n=t[0],o=(0,d.K2)((e=>[...t,...a].find((t=>t.nodeId===e))),"nodeById"),i=(0,d.K2)((t=>t?16*t.length+16:0),"estimateArrowLabelWidth"),l=(0,d.K2)(((t,a,r)=>{const n=e.filter((e=>e.parent===t));if(0===n.length)return 50;let o=0;return n.forEach((e=>{o+=l(e.child,a+1,t)})),Math.max(50,o+20*(n.length-1))}),"calculateSubtreeWidth"),s=(0,d.K2)(((t,a,n,d,c=!1)=>{r[t]={x:a,y:n};const p=e.filter((e=>e.parent===t));if(0===p.length)return;const h=p.map((e=>l(e.child,0,t))),m=h.reduce(((t,e)=>t+e),0);let f=0;const x=p.map((t=>o(t.child)));x.forEach(((t,e)=>{t&&t.arrow&&E(t.arrowLabel)&&e<x.length-1&&(f+=i(t.arrowLabel?String(t.arrowLabel):""))}));const g=20*(p.length-1)+f,b=Math.max(g,d-m),w=p.length>1?b/(p.length-1):0;let u=a-d/2;p.forEach(((t,e)=>{const a=u+h[e]/2,r=n+100;s(t.child,a,r,h[e],!1),u+=h[e]+w}))}),"calculatePosition"),c=e.filter((t=>t.parent===n.nodeId));let p=0;n.arrow&&E(n.arrowLabel)&&(p+=i(n.arrowLabel?String(n.arrowLabel):""));const h=c.map((t=>o(t.child)));h.forEach(((t,e)=>{t&&t.arrow&&E(t.arrowLabel)&&e<h.length-1&&(p+=i(t.arrowLabel?String(t.arrowLabel):""))}));const m=l(n.nodeId,0,void 0)+p,f=Math.min(m,859+p);return s(n.nodeId,479.5,50,f,!0),r}),"calculateNodePositions"),j=(0,d.K2)(((t,e,a,r)=>{const n=a.x,o=a.y,i=k(e.color),l=t.append("g");l.attr("class","unit").attr("id",`unit_${r}`),l.append("circle").attr("cx",n).attr("cy",o).attr("r",20).style("fill",i).attr("stroke","black").attr("stroke-width","1").attr("class","treeNode");const s=F(e.value||e.nodeId);let c=16;function p(e,a){const r=t.append("text").attr("x",-9999).attr("y",-9999).attr("font-size",a).attr("font-family","sans-serif").text(e);let n=0;const o=r.node();return o&&(n=o.getBBox().width),r.remove(),n}(0,d.K2)(p,"measureTextWidth");let h=[s],m=!1;for(;!m&&c>=9;){if(p(s,c)<=32){m=!0;break}c-=1}function f(t,e){if(p(t,e)<=32||t.length<=1)return[t];const a=Math.floor(t.length/2);let r=a;for(let e=0;e<a;e++){if(" "===t[a+e]){r=a+e;break}if(" "===t[a-e]){r=a-e;break}}return" "===t[r]?[t.slice(0,r),t.slice(r+1)].flatMap((t=>f(t,e))):[t.slice(0,r),t.slice(r)].flatMap((t=>f(t,e)))}if((0,d.K2)(f,"splitLineRecursively"),!m){h=f(s,c);let t=!1;for(;!t;){t=!0;const e=[];for(const a of h)p(a,c)>32&&a.length>1?(t=!1,e.push(...f(a,c))):e.push(a);h=e}}if(1===h.length)l.append("text").attr("x",n).attr("y",o).attr("dy",".1em").attr("fill","black").attr("font-size",c).attr("font-family","sans-serif").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","nodeLabel").text(h[0]);else{const t=o-h.length*c*1.1/2+.85*c;h.forEach(((e,a)=>{l.append("text").attr("x",n).attr("y",t+a*c*1.1).attr("fill","black").attr("font-size",c).attr("font-family","sans-serif").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","nodeLabel").text(e)}))}if(e.arrow&&E(e.arrowLabel)){const t=Math.round(n+45),a=Math.round(n+25),r=Math.round(o);l.append("line").attr("x1",t).attr("y1",r).attr("x2",a).attr("y2",r).attr("stroke","black").attr("stroke-width","2").attr("marker-end","url(#arrowhead)"),l.append("text").attr("x",t+5).attr("y",r).attr("fill","black").attr("font-size","16").attr("dominant-baseline","middle").attr("text-anchor","start").attr("class","arrowLabel").text(F(e.arrowLabel||""))}}),"drawNode"),H=(0,d.K2)(((t,e,a)=>{const r=a[e.parent],n=a[e.child];if(r&&n){const{startX:e,startY:a,endX:o,endY:i}=U(r,n);t.append("line").attr("x1",e).attr("y1",a).attr("x2",o).attr("y2",i).attr("stroke","black").attr("stroke-width","2")}}),"drawEdge"),U=(0,d.K2)(((t,e)=>{const a=e.x-t.x,r=e.y-t.y,n=Math.sqrt(a*a+r*r),o=20*a/n,i=20*r/n;return{startX:t.x+o,startY:t.y+i,endX:e.x-o,endY:e.y-i}}),"calculateEdgePosition"),q=(0,d.K2)(((t,e,a)=>{const r=t.append("g");r.attr("class","component").attr("id",`component_${a}`),r.append("defs").append("marker").attr("id","arrowhead_node").attr("viewBox","0 0 10 10").attr("refX","5").attr("refY","5").attr("markerWidth","5").attr("markerHeight","6").attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("fill","black"),r.append("defs").append("marker").attr("id","arrowhead").attr("viewBox","0 0 10 10").attr("refX","5").attr("refY","5").attr("markerWidth","3").attr("markerHeight","5").attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("fill","black");const n=e.elements,o=R(n||[]);let i=0;if(n&&n.forEach(((t,e)=>{G(r,t,o[e],e<n.length-1,i),i+=1})),e.label){const t=100,a=150;r.append("text").attr("x",a).attr("y",t).attr("fill","black").attr("font-size","18").attr("dominant-baseline","hanging").attr("text-anchor","middle").attr("class","linkedListDiagramLabel").text(e.label)}}),"drawLinkedListDiagram"),R=(0,d.K2)((t=>{const e=[];return t.forEach(((t,a)=>{e.push({x:50+120*a,y:50})})),e}),"calculateNodePositions"),G=(0,d.K2)(((t,e,a,r,n)=>{const o=a.x,i=a.y,l=k(e.color),s=t.append("g");if(s.attr("class","unit").attr("id",`unit_${n}`),s.append("rect").attr("x",o).attr("y",i).attr("width",60).attr("height",30).style("fill",l).attr("stroke","black").attr("stroke-width","1").attr("class","linkedListNode"),s.append("text").attr("x",o+30).attr("y",i+15).attr("dy",".35em").attr("fill","black").attr("font-size","18").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","nodeLabel").text(F(e.value)),E(e.arrowLabel)){const t=i-30,a=i-10;s.append("line").attr("x1",o+30).attr("y1",t).attr("x2",o+30).attr("y2",a).attr("stroke","black").attr("stroke-width","2").attr("marker-end","url(#arrowhead)"),s.append("text").attr("x",o+30).attr("y",t-10).attr("fill","black").attr("font-size","16").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","arrowLabel").text(F(e.arrowLabel||""))}r&&s.append("line").attr("x1",o+60).attr("y1",i+15).attr("x2",o+60+55).attr("y2",i+15).attr("stroke","black").attr("stroke-width","2").attr("marker-end","url(#arrowhead_node)")}),"drawNode"),V=(0,d.K2)(((t,e,a)=>{const r=t.append("g");r.attr("class","component").attr("id",`component_${a}`);let n=0,o=0;if(e.elements.forEach((t=>{n=O(r,t,n,o,e),o+=1})),e.label){const t=n+(e.lineSpacing||20);let a=50,o="start";switch(e.align||"left"){case"center":o="middle",a=(e.width||200)/2;break;case"right":o="end",a=(e.width||200)-50;break;default:o="start",a=50}r.append("text").attr("x",a).attr("y",t).attr("fill",e.color||"black").attr("font-size",e.fontSize||16).attr("font-weight",e.fontWeight||"normal").attr("font-family",e.fontFamily||"sans-serif").attr("dominant-baseline","hanging").attr("text-anchor",o).attr("class","textDiagramLabel").text(e.label)}}),"drawTextDiagram"),O=(0,d.K2)(((t,e,a,r,n)=>{const o=t.append("g").attr("class","unit").attr("id",`unit_${r}`);let i,l={};"string"==typeof e?i=e:(i=e.value,l=e);const s=l.fontSize||n?.fontSize||20,d=l.color||n?.color||"black",c=l.fontWeight||n?.fontWeight||"normal",p=l.fontFamily||n?.fontFamily||"sans-serif",h=l.align||n?.align||"left",m=n?.lineSpacing||20;let f,x=50;switch(h){case"center":f="middle",x=(n?.width||200)/2;break;case"right":f="end",x=(n?.width||200)-50;break;default:f="start",x=50}const g=i.split("\n");return g.forEach(((t,e)=>{const r=a+e*m;o.append("text").attr("x",x).attr("y",r).attr("fill",d).attr("font-size",s).attr("font-weight",c).attr("font-family",p).attr("dominant-baseline","hanging").attr("text-anchor",f).attr("class","textElement").text(F(t))})),a+g.length*m}),"drawElement"),J=(0,d.K2)((t=>{const e=[],a=new Set;return t.forEach(((t,r)=>{if(a.has(r))return;if("text"===t.type&&t.position&&"object"==typeof t.position&&"type"in t.position&&"previous"===t.position.type){let n=null;for(let t=e.length-1;t>=0;t--){const a=e[t];if("text"!==a.type||a.position){n=a;break}}return void(n&&(n.textItems.push({item:{...t,index:r},placement:t.position.placement||t.placement||"below"}),a.add(r)))}const n=t.position&&"object"==typeof t.position&&"column"in t.position&&"row"in t.position,o={type:t.type,position:n?t.position:void 0,mainItem:{...t,index:r},textItems:[]};e.push(o),a.add(r)})),e}),"processItemsWithRelativePositioning"),Q={parser:y,db:w,renderer:{draw:(0,d.K2)(((t,e,a,r)=>{const n=r.db,o=n.getConfig(),l=n.getPages(),c=n.getDiagramTitle(),p=n.getSize&&n.getSize(),h=p?.width||1e3,m=p?.height||800,f=(0,i.D)(e),x=(0,d.K2)(((t,e,a)=>{const r=t.append("g").attr("id",`page${a}`).attr("class","page").attr("display",0===a?"inline":"none");c&&r.append("text").text(c).attr("x",h/2).attr("y",25).attr("dominant-baseline","middle").attr("text-anchor","middle").attr("class","pageTitle");const n=e.layout?{columns:e.layout.columns,rows:e.layout.rows}:{columns:1,rows:1},i=c?50:20,l=h-40,s=m-i-20,d=J(e.subDiagrams);let p=n.columns-1,f=n.rows-1;d.forEach((t=>{if(t.position){const{column:e,row:a}=t.position,r=("object"==typeof e&&e.start,"object"==typeof e?e.end:e),n=("object"==typeof a&&a.start,"object"==typeof a?a.end:a);p=Math.max(p,r),f=Math.max(f,n)}})),n.columns=Math.max(n.columns,p+1),n.rows=Math.max(n.rows,f+1);const x=[],g=[];d.forEach((t=>{if(t.position){const{column:e,row:a}=t.position,r="object"==typeof e?e.start:e,o="object"==typeof e?e.end:e,i="object"==typeof a?a.start:a,l="object"==typeof a?a.end:a;i>=0&&l<n.rows&&r>=0&&o<n.columns&&i<=l&&r<=o?x.push({item:t,position:{colStart:r,colEnd:o,rowStart:i,rowEnd:l}}):g.push(t)}else g.push(t)}));let w=0;x.forEach((({position:t})=>{w+=(t.colEnd-t.colStart+1)*(t.rowEnd-t.rowStart+1)}));const u=n.columns*n.rows-w,y=g.length;if(y>u){const t=w+y;let e=n.columns,a=n.rows;const r=3;for(;e*a<t;){const t=e/a;t>r?a++:t<1/r||e<=a?e++:a++}n.columns=e,n.rows=a}const k=l/n.columns,L=s/n.rows,v=[];for(let t=0;t<n.rows;t++){v[t]=[];for(let e=0;e<n.columns;e++)v[t][e]={x:20+e*k,y:i+t*L,occupied:!1}}x.forEach((({position:t})=>{for(let e=t.rowStart;e<=t.rowEnd;e++)for(let a=t.colStart;a<=t.colEnd;a++)v[e]&&v[e][a]&&(v[e][a].occupied=!0)})),x.sort(((t,e)=>t.item.mainItem.index-e.item.mainItem.index)),x.forEach((({item:t,position:e})=>{const a=v[e.rowStart][e.colStart],n=(e.colEnd-e.colStart+1)*k,i=(e.rowEnd-e.rowStart+1)*L;b(r,t,a.x,a.y,n,i,o)}));let F=0,E=0;g.sort(((t,e)=>t.mainItem.index-e.mainItem.index)),g.forEach((t=>{for(;F<n.rows&&v[F][E].occupied;)E++,E>=n.columns&&(E=0,F++);const e=v[F][E];b(r,t,e.x,e.y,k,L,o),v[F][E].occupied=!0,E++,E>=n.columns&&(E=0,F++)}))}),"drawPage"),g=(0,d.K2)(((t,e,a)=>{switch(e.type){case"array":D(t,e,a,e.index);break;case"matrix":S(t,e,a,e.index);break;case"stack":C(t,e,e.index);break;case"graph":T(t,e,e.index);break;case"tree":X(t,e,e.index);break;case"linkedList":q(t,e,e.index);break;case"text":V(t,e,e.index);break;default:throw new Error(`Unknown diagram type: ${e.type}`)}}),"drawSingleDiagram"),b=(0,d.K2)(((t,e,a,r,n,o,i)=>{if(0===e.textItems.length)return void w(t,e.mainItem,a,r,n,o,i);const l=t.append("g").attr("class",`container-${e.type}`).attr("id",`container-${e.mainItem.index}`),s=l.append("g").attr("class","temp-main").style("visibility","hidden");g(s,e.mainItem,i);const d=s.node().getBBox();s.remove();const c=[];e.textItems.forEach((({item:t,placement:e})=>{const a=l.append("g").attr("class","temp-text").style("visibility","hidden");g(a,t,i);const r=a.node().getBBox();a.remove(),c.push({bbox:r,placement:e,item:t})}));let p=d.width,h=d.height,m=0,f=0,x=0,b=0;c.forEach((({bbox:t,placement:e})=>{switch(e){case"left":m=Math.max(m,t.width+10);break;case"right":f=Math.max(f,t.width+10);break;case"above":x=Math.max(x,t.height+10);break;case"below":b=Math.max(b,t.height+10)}})),p+=m+f,h+=x+b;const u=(n-20)/p,y=(o-20)/h,k=Math.min(1,u,y),L=a+n/2-p*k/2,v=r+o/2-h*k/2;l.attr("transform",`translate(${L}, ${v}) scale(${k})`);const F=m-d.x,E=x-d.y,D=l.append("g").attr("class",`main-${e.type}`).attr("transform",`translate(${F}, ${E})`);g(D,e.mainItem,i),c.forEach((({bbox:t,placement:e,item:a})=>{const r=l.append("g").attr("class","text-item");let n=0,o=0;const s=m,c=x;switch(e){case"left":n=s-t.width-10,o=c+d.height/2-t.height/2;break;case"right":n=s+d.width+10,o=c+d.height/2-t.height/2;break;case"above":n=s+d.width/2-t.width/2,o=c-t.height-10;break;case"below":n=s+d.width/2-t.width/2,o=c+d.height+10}n-=t.x,o-=t.y,r.attr("transform",`translate(${n}, ${o})`),g(r,a,i)}))}),"drawGroupAtPosition"),w=(0,d.K2)(((t,e,a,r,n,o,i)=>{const l=t.append("g").attr("class","temp-measure").style("visibility","hidden");g(l,e,i);const s=l.node().getBBox(),d=s.width,c=s.height,p=s.x,h=s.y,m=(n-20)/d,f=(o-20)/c,x=Math.min(1,m,f),b=a+n/2-(p+d/2)*x,w=r+o/2-(h+c/2)*x;l.remove();const u=t.append("g").attr("class",`viewport-${e.type}`).attr("id",`viewport-${e.index}`);u.attr("transform",`translate(${b}, ${w}) scale(${x})`),g(u,e,i)}),"drawDiagramAtPosition");f.attr("viewBox",`0 0 ${h} ${m}`),(0,s.a$)(f,m,h,o.useMaxWidth),l.forEach(((t,e)=>{x(f,t,e)}))}),"draw")},styles:(0,d.K2)(((t={})=>(s.Rm.debug({options:t}),`\n    .element {\n      font-size: ${t.array?.elementFontSize??"10px"};\n      fill: ${t.array?.valueColor??"black"};\n    }\n    .element.index {\n      fill: ${t.array?.indexColor??"black"};\n    }\n    .element {\n      stroke: ${t.array?.elementStrokeColor??"black"};\n      stroke-width: ${t.array?.elementStrokeWidth??"1"};\n      fill: ${t.array?.elementFillColor??"#efefef"};\n    }\n  `)),"styles")}}}]);