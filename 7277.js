"use strict";(self.webpackChunkonsenui_v2_react_minimum=self.webpackChunkonsenui_v2_react_minimum||[]).push([[7277],{7277:(e,t,s)=>{s.d(t,{diagram:()=>M});var o=s(9673),i=s(9592),a=s(6412),r=s(9342),n=s(8812),d=s(6852),c="rect",l="rectWithTitle",p="statediagram",g=`${p}-state`,b="transition",u=`${b} note-edge`,h=`${p}-note`,y=`${p}-cluster`,f=`${p}-cluster-alt`,m="parent",w="note",x="----",$=`${x}${w}`,D=`${x}${m}`,T="fill:none",k="fill: #333",R="text",S="normal",v={},A=0,C={},B=(0,d.K2)((function(e){const t=Object.keys(e);for(const s of t)C[s]=e[s]}),"setConf"),K=(0,d.K2)((function(e,t){return t.db.extract(t.db.getRootDocV2()),t.db.getClasses()}),"getClasses");function _(e){return null==e?"":e.classes?e.classes.join(" "):""}function E(e="",t=0,s="",o=x){return`state-${e}${null!==s&&s.length>0?`${o}${s}`:""}-${t}`}(0,d.K2)(_,"getClassesFromDbInfo"),(0,d.K2)(E,"stateDomId");var N=(0,d.K2)(((e,t,s,i,a,d)=>{const p=s.id,b=_(i.get(p));if("root"!==p){let t=c;!0===s.start&&(t="start"),!1===s.start&&(t="end"),s.type!==o.nf&&(t=s.type),v[p]||(v[p]={id:p,shape:t,description:n.Y2.sanitizeText(p,(0,n.D7)()),classes:`${b} ${g}`});const i=v[p];s.description&&(Array.isArray(i.description)?(i.shape=l,i.description.push(s.description)):i.description.length>0?(i.shape=l,i.description===p?i.description=[s.description]:i.description=[i.description,s.description]):(i.shape=c,i.description=s.description),i.description=n.Y2.sanitizeTextOrArray(i.description,(0,n.D7)())),1===i.description.length&&i.shape===l&&(i.shape=c),!i.type&&s.doc&&(n.Rm.info("Setting cluster for ",p,V(s)),i.type="group",i.dir=V(s),i.shape=s.type===o.n6?"divider":"roundedWithTitle",i.classes=i.classes+" "+y+" "+(d?f:""));const a={labelStyle:"",shape:i.shape,labelText:i.description,classes:i.classes,style:"",id:p,dir:i.dir,domId:E(p,A),type:i.type,padding:15,centerLabel:!0};if(s.note){const t={labelStyle:"",shape:"note",labelText:s.note.text,classes:h,style:"",id:p+$+"-"+A,domId:E(p,A,w),type:i.type,padding:15},o={labelStyle:"",shape:"noteGroup",labelText:s.note.text,classes:i.classes,style:"",id:p+D,domId:E(p,A,m),type:"group",padding:0},n=p+D;e.setNode(n,o),e.setNode(t.id,t),e.setNode(p,a),e.setParent(p,n),e.setParent(t.id,n);let d=p,c=t.id;"left of"===s.note.position&&(d=t.id,c=p),e.setEdge(d,c,{arrowhead:"none",arrowType:"",style:T,labelStyle:"",id:(0,r.rY)(d,c,{counter:A}),classes:u,arrowheadStyle:k,labelpos:"c",labelType:R,thickness:S}),A++}else e.setNode(p,a)}t&&"root"!==t.id&&(n.Rm.trace("Setting node ",p," to be child of its parent ",t.id),e.setParent(p,t.id)),s.doc&&(n.Rm.trace("Adding nodes children "),P(e,s,s.doc,i,a,!d))}),"setupNode"),P=(0,d.K2)(((e,t,s,i,a,d)=>{n.Rm.trace("items",s),s.forEach((s=>{switch(s.stmt){case o.Px:case o.nf:N(e,t,s,i,a,d);break;case o.qC:{N(e,t,s.state1,i,a,d),N(e,t,s.state2,i,a,d);const o={id:(0,r.rY)(s.state1.id,s.state2.id,{counter:A}),arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:T,labelStyle:"",label:n.Y2.sanitizeText(s.description,(0,n.D7)()),arrowheadStyle:k,labelpos:"c",labelType:R,thickness:S,classes:b};e.setEdge(s.state1.id,s.state2.id,o,A),A++}}}))}),"setupDoc"),V=(0,d.K2)(((e,t=o.jX)=>{let s=t;if(e.doc)for(let t=0;t<e.doc.length;t++){const o=e.doc[t];"dir"===o.stmt&&(s=o.value)}return s}),"getDir"),I={setConf:B,getClasses:K,draw:(0,d.K2)((async function(e,t,s,d){n.Rm.info("Drawing state diagram (v2)",t),v={};let l=d.db.getDirection();void 0===l&&(l=o.gO);const{securityLevel:g,state:b}=(0,n.D7)(),u=b.nodeSpacing||50,h=b.rankSpacing||50;n.Rm.info(d.db.getRootDocV2()),d.db.extract(d.db.getRootDocV2()),n.Rm.info(d.db.getRootDocV2());const y=d.db.getStates(),f=new a.T({multigraph:!0,compound:!0}).setGraph({rankdir:V(d.db.getRootDocV2()),nodesep:u,ranksep:h,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));let m;N(f,void 0,d.db.getRootDocV2(),y,d.db,!0),"sandbox"===g&&(m=(0,n.df)("#i"+t));const w="sandbox"===g?(0,n.df)(m.nodes()[0].contentDocument.body):(0,n.df)("body"),x=w.select(`[id="${t}"]`),$=w.select("#"+t+" g");await(0,i.X)($,f,["barb"],p,t),r._K.insertTitle(x,"statediagramTitleText",b.titleTopMargin,d.db.getDiagramTitle());const D=x.node().getBBox(),T=D.width+16,k=D.height+16;x.attr("class",p);const R=x.node().getBBox();(0,n.a$)(x,k,T,b.useMaxWidth);const S=`${R.x-8} ${R.y-8} ${T} ${k}`;n.Rm.debug(`viewBox ${S}`),x.attr("viewBox",S);const A=document.querySelectorAll('[id="'+t+'"] .edgeLabel .label');for(const e of A){const t=e.getBBox(),s=document.createElementNS("http://www.w3.org/2000/svg",c);s.setAttribute("rx",0),s.setAttribute("ry",0),s.setAttribute("width",t.width),s.setAttribute("height",t.height),e.insertBefore(s,e.firstChild)}}),"draw")},M={parser:o.Zk,db:o.iP,renderer:I,styles:o.tM,init:e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,o.iP.clear()}}}}]);